function fieldval_ui_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function FVForm(e){var r=this;r.element=$("<form />").addClass("fv_form").append(r.error_message=$("<div />").addClass("fv_error_message").hide()).on("submit",function(e){e.preventDefault(),r.submit()}),r.fields=e||{},r.fields_element=r.element,r.submit_callbacks=[]}function Field(e,r){var t=this;t.name=e,t.options=r||{},t.show_on_form_flag=!0,t.is_in_array=!1,t.on_change_callbacks=[],t.container=$("<div />").addClass("fv_field_container"),t.element=$("<div />").addClass("fv_field"),t.title=$("<div />").addClass("fv_field_title").text(t.name),t.options.description&&(t.description_label=$("<div />").addClass("fv_field_description").text(t.options.description)),t.input_holder=$("<div />").addClass("fv_input_holder"),t.error_message=$("<div />").addClass("fv_error_message").hide(),t.layout()}function TextField(e,r){var t=this,o=typeof r;"string"===o?(t.input_type=r,r={}):"object"===o?t.input_type=r.type||"text":r={},TextField.superConstructor.call(this,e,r),t.element.addClass("fv_text_field"),t.input=$("textarea"===t.input_type?"<textarea />":"text"!==t.input_type&&"number"!==t.input_type&&t.input_type?"<input type='"+t.input_type+"' />":"<input type='text' />"),t.input.addClass("fv_text_input").attr("placeholder",e).on("keyup",function(){t.did_change()}).appendTo(t.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e,r){var t=this;DisplayField.superConstructor.call(this,e,r),t.element.addClass("fv_display_field"),t.input=$("<div />").appendTo(t.input_holder),t.hide_on_form()}function ChoiceField(e,r){var t=this;ChoiceField.superConstructor.call(this,e,r),t.choices=t.options.choices||[],t.allow_empty=t.options.allow_empty||!1,t.element.addClass("fv_choice_field"),t.select=$("<select/>").addClass("fv_choice_input").appendTo(t.input_holder),setTimeout(function(){t.select.on("change",function(){t.did_change()})},100),t.choice_values=[],t.allow_empty&&(t.empty_option=$("<option />").attr({value:null}).text(t.options.empty_message||""),t.select.append(t.empty_option));for(var o=0;o<t.choices.length;o++){var i,n,l=t.choices[o];"object"==typeof l?(i=l[0],n=l[1]):i=n=l,t.choice_values.push(i);var a=$("<option />").attr("value",i).text(n);t.select.append(a)}}function DateField(e,r){var t=this;if("undefined"==typeof DateVal)return void console.error("DateField requires fieldval-dateval-js");DateField.superConstructor.call(this,e,r),t.element.addClass("fv_date_field"),t.format_string=t.options.format||"yyyy-MM-dd";var o=DateVal.date_format().check(t.format_string,function(e){t.format_array=e});if(o)return void console.error(o.error_message);t.inputs=[];for(var i=0;i<t.format_array.length;i++){var n=t.format_array[i],l=DateVal.date_components[n];t.add_element_from_component(n,l)}}function BooleanField(e,r){var t=this;BooleanField.superConstructor.call(this,e,r),t.element.addClass("fv_boolean_field"),t.input=$("<input type='checkbox' />").addClass("fv_boolean_input").on("change",function(){t.did_change()}).appendTo(t.input_holder)}function ObjectField(e,r){var t=this;ObjectField.superConstructor.call(this,e,r),t.element.addClass("fv_object_field"),t.fields_element=t.input_holder,t.fields={}}function ArrayField(e,r){var t=this;ArrayField.superConstructor.call(this,e,r),t.element.addClass("fv_array_field"),t.input_holder.append(t.fields_element=$("<div />").addClass("fv_nested_fields"),t.create_add_field_button()),t.fields=[],console.log(t.input_holder)}FVForm.button_event="click",FVForm.prototype.init=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.init()}},FVForm.prototype.remove=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.remove()}},FVForm.prototype.blur=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.blur()}return e},FVForm.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();return e},FVForm.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();return e},FVForm.prototype.on_submit=function(e){var r=this;return r.submit_callbacks.push(e),r},FVForm.prototype.submit=function(){for(var e=this,r=e.val(),t=0;t<e.submit_callbacks.length;t++){var o=e.submit_callbacks[t];o(r)}return r},FVForm.prototype.add_field=function(e,r){var t=this;return r.container.appendTo(t.fields_element),t.fields[e]=r,t},FVForm.prototype.remove_field=function(e){var r=this,t=r.fields[e];t&&(t.remove(),delete r.fields[e])},FVForm.prototype.clear_errors=function(){var e=this;e.error(null)},FVForm.prototype.fields_error=function(e){var r=this;if(e){var t=e.invalid||{},o=e.missing||{},i=e.unrecognized||{};for(var n in r.fields){var l=r.fields[n],a=t[n]||o[n]||i[n]||null;l.error(a)}}else for(var n in r.fields){var l=r.fields[n];l.error(null)}},FVForm.prototype.show_error=function(){var e=this;e.error_message.show()},FVForm.prototype.hide_error=function(){var e=this;e.error_message.hide()},FVForm.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),o=0;o<e.errors.length;o++){var i=e.errors[o];0===i.error?r.fields_error(i):t.append($("<li />").text(i.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},FVForm.prototype.disable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.disable()}},FVForm.prototype.enable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.enable()}},FVForm.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var o in r.fields){var i=r.fields[o];if(i.show_on_form_flag!==!1){var n=i.val();null!=n&&(t[o]=n)}}return t}for(var o in r.fields){var i=r.fields[o];i.val(e[o])}return r},Field.prototype.in_array=function(e){var r=this;r.is_in_array=!0,r.element.addClass("fv_nested").append($("<button />").addClass("fv_field_remove_button").text("X").on(FVForm.button_event,function(t){t.preventDefault(),e(),r.remove()}))},Field.prototype.init=function(){},Field.prototype.remove=function(){var e=this;e.container.remove()},Field.prototype.view_mode=function(){},Field.prototype.edit_mode=function(){},Field.prototype.change_name=function(e){var r=this;return r.name=e,r},Field.prototype.layout=function(){var e=this;e.container.append(e.title,e.description_label,e.element.append(e.input_holder,e.error_message))},Field.prototype.on_change=function(e){var r=this;return r.on_change_callbacks.push(e),r},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,r=e.val(),t=0;t<e.on_change_callbacks.length;t++){var o=e.on_change_callbacks[t];o(r)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var r=this;if(e){if(r.error_message.empty(),4===e.error){for(var t=$("<ul />"),o=0;o<e.errors.length;o++){var i=e.errors[o];t.append($("<li />").text(i.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.container&&r.container.addClass("fv_field_error"),r.show_error()}else r.hide_error(),r.container&&r.container.removeClass("fv_field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.view_mode=function(){var e=this;e.input.prop({readonly:"readonly",disabled:"disabled"}),e.element.addClass("fv_view_mode")},TextField.prototype.edit_mode=function(){var e=this;e.input.prop({readonly:null,disabled:null}),e.element.removeClass("fv_view_mode")},TextField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},TextField.prototype.change_name=function(e){var r=this;return TextField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^\d+(\.\d+)?$/,TextField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.input.val();return"number"===r.input_type&&TextField.numeric_regex.test(t)?parseFloat(t):0===t.length?null:t}return r.input.val(e),r},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},DisplayField.prototype.change_name=function(e){var r=this;return DisplayField.superClass.change_name.call(this,e),r},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var r=[],t=e.split(/\n/),o=jQuery(document.createElement("div")),i=0;i<t.length;i++)r.push(o.text(t[i]).html());return r.join("<br>")},DisplayField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.text():(r.input.html(DisplayField.replace_line_breaks(e)),r)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.select.find(":selected"),o=t.index()-(r.allow_empty?1:0);return r.allow_empty&&-1===o?null:r.choice_values[o]}return r.select.val(null!=e?e:r.allow_empty?r.empty_option:r.choice_values[0]),r},fieldval_ui_extend(DateField,Field),DateField.prototype.add_element_from_component=function(e,r){var t=this;if(0===r){var o=e;t.inputs.push(null),t.input_holder.append($("<div />").addClass("fv_date_separator").text(o))}else{var i=r[r.length-1],n=$("<input />").attr({placeholder:e,size:i,maxlength:i}).addClass("fv_date_input").on("keyup",function(){t.did_change()});n.blur(function(){var e=n.val(),t=DateField.pad_to_valid(e,r);n.val(t)}),t.inputs.push(n),t.input_holder.append(n)}},DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var r=this;return DateField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},DateField.prototype.disable=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.attr("disabled","disabled")}return e},DateField.prototype.enable=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.attr("disabled",null)}return e},DateField.prototype.focus=function(){var e=this,r=e.inputs[0];return r&&r.blur(),e},DateField.prototype.blur=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.blur()}return e},DateField.pad_to_valid=function(e,r){for(var t=0;t<r.length;t++){var o=r[t];if(e.length<=o){for(var i=o-e.length,n=0;i>n;n++)e="0"+e;return e}}return e},DateField.prototype.val=function(e){var r=this;if(0===arguments.length){for(var t="",o=0;o<r.format_array.length;o++){var i=r.format_array[o],n=DateVal.date_components[i];if(0===n)t+=i;else{var l=r.inputs[o],a=l.val().toString();t+=DateField.pad_to_valid(a,n)}}return t}if(null!=e){var s,d=DateVal.date(r.format_string,{emit:DateVal.EMIT_COMPONENT_ARRAY}).check(e,function(e){s=e});d&&console.error("Invalid format passed to .val of DateField");for(var o=0;o<r.format_array.length;o++){var i=r.format_array[o],n=DateVal.date_components[i];if(0===n)t+=i;else{var l=r.inputs[o];l.val(s[o])}}}return r},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.is(":checked"):(r.input.prop("checked",e),r)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.init=function(){FVForm.prototype.init.call(this)},ObjectField.prototype.remove=function(){FVForm.prototype.remove.call(this),Field.prototype.remove.call(this)},ObjectField.prototype.add_field=function(e,r){FVForm.prototype.add_field.call(this,e,r)},ObjectField.prototype.change_name=function(e){var r=this;return ObjectField.superClass.change_name.call(this,e),r},ObjectField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode()},ObjectField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode()},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){FVForm.prototype.blur.call(this)},ObjectField.prototype.error=function(e){ObjectField.superClass.error.call(this,e),FVForm.prototype.error.call(this,e)},ObjectField.prototype.fields_error=function(e){FVForm.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){FVForm.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var o in r.fields){var i=r.fields[o];t[o]=i.val()}return t}for(var o in e){var i=r.fields[o];i&&i.val(e[o])}return r},fieldval_ui_extend(ArrayField,Field),ArrayField.prototype.create_add_field_button=function(){var e=this;return $("<button />").addClass("fv_add_field_button").text("+").on(FVForm.button_event,function(r){r.preventDefault(),e.new_field(e.fields.length)})},ArrayField.prototype.new_field=function(){console.error("ArrayField.new_field must be overriden to create fields")},ArrayField.prototype.add_field=function(e,r){var t=this;r.in_array(function(){t.remove_field(r)}),r.container.appendTo(t.fields_element),t.fields.push(r)},ArrayField.prototype.remove_field=function(e){for(var r=this,t=0;t<r.fields.length;t++)r.fields[t]===e&&r.fields.splice(t,1)},ArrayField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode()},ArrayField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode()},ArrayField.prototype.error=function(e){ArrayField.superClass.error.call(this,e)},ArrayField.prototype.fields_error=function(e){var r=this;if(e)for(var t=e.invalid||{},o=e.missing||{},i=e.unrecognized||{},n=0;n<r.fields.length;n++){var l=r.fields[n],a=t[n]||o[n]||i[n]||null;l.error(a)}else for(var n in r.fields){var l=r.fields[n];l.error(null)}},ArrayField.prototype.clear_errors=function(){},ArrayField.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),o=0;o<e.errors.length;o++){var i=e.errors[o];0===i.error?r.fields_error(i):t.append($("<li />").text(i.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},ArrayField.prototype.val=function(e){var r=this;if(0===arguments.length){for(var t=[],o=0;o<r.fields.length;o++){var i=r.fields[o],n=i.val();t.push(n)}return t}if(e)for(var o=0;o<e.length;o++){var i=r.fields[o];i||(i=r.new_field(o)),i.val(e[o])}return r};