function fieldval_ui_extend(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superConstructor=t,e.superClass=t.prototype}function FVForm(e){var t=this;t.element=$("<form />").addClass("fieldval_ui_form").append(t.error_message=$("<div />").addClass("error_message").hide()).on("submit",function(e){e.preventDefault(),t.submit()}),t.fields=e||{},t.fields_element=t.element,t.submit_callbacks=[]}function Field(e){var t=this;t.name=e,t.show_on_form_flag=!0,t.on_change_callbacks=[],t.container=$("<div />").addClass("field_container"),t.element=$("<div />").addClass("field"),t.title=$("<div />").addClass("field_title").text(t.name),t.input_holder=$("<div />").addClass("input_holder"),t.error_message=$("<div />").addClass("error_message").hide(),t.layout()}function TextField(e,t){var r=this,i=typeof t;"string"===i?(r.input_type=t,t={}):"object"===i?r.input_type=t.type||"text":t={},r.options=t,TextField.superConstructor.call(this,e),r.element.addClass("text_field"),r.input=$("textarea"===r.input_type?"<textarea />":"text"!==r.input_type&&"number"!==r.input_type&&r.input_type?"<input type='"+r.input_type+"' />":"<input type='text' />"),r.input.addClass("text_input").attr("placeholder",e).on("keyup",function(){r.did_change()}).appendTo(r.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e){var t=this;DisplayField.superConstructor.call(this,e),t.element.addClass("display_field"),t.input=$("<div />").appendTo(t.input_holder),t.hide_on_form()}function ChoiceField(e,t){var r=this;if(ChoiceField.superConstructor.call(this,e,t),r.properties=t,r.choices=r.properties.choices||[],r.allow_empty=r.properties.allow_empty||!1,r.element.addClass("choice_field"),r.select=$("<select/>").addClass("choice_input").appendTo(r.input_holder),setTimeout(function(){r.select.on("change",function(){r.did_change()})},100),r.choice_values=[],r.allow_empty){var i=$("<option />").attr("value",null).text("");r.select.append(i)}for(var o=0;o<r.choices.length;o++){var n,l,a=r.choices[o];"object"==typeof a?(n=a[0],l=a[1]):n=l=a,r.choice_values.push(n);var i=$("<option />").attr("value",n).text(l);r.select.append(i)}}function DateField(e,t){var r=this;r.format=t,DateField.superConstructor.call(this,e),r.element.addClass("date_field"),r.input_holder.append(r.day_input=$("<input type='number' />").addClass("day_input date_input").attr("placeholder","DD").on("keyup",function(){r.did_change()}),r.month_input=$("<input type='number' />").addClass("month_input date_input").attr("placeholder","MM").on("keyup",function(){r.did_change()}),r.year_input=$("<input type='number' />").addClass("year_input date_input").attr("placeholder","YYYY").on("keyup",function(){r.did_change()}))}function BooleanField(e){var t=this;BooleanField.superConstructor.call(this,e),t.element.addClass("choice_field"),t.input=$("<input type='checkbox' />").addClass("boolean_input").on("change",function(){t.did_change()}).appendTo(t.input_holder)}function ObjectField(e,t){var r=this;r.options=t||{},ObjectField.superConstructor.call(this,e),r.element.addClass("object_field"),r.fields_element=r.input_holder,r.fields={}}FVForm.prototype.init=function(){var e=this;for(var t in e.fields){var r=e.fields[t];r.init()}},FVForm.prototype.remove=function(){var e=this;for(var t in e.fields){var r=e.fields[t];r.remove()}},FVForm.prototype.blur=function(){var e=this;for(var t in e.fields){var r=e.fields[t];r.blur()}return e},FVForm.prototype.edit_mode=function(){var e=this;for(var t in e.fields)e.fields[t].edit_mode();return e},FVForm.prototype.view_mode=function(){var e=this;for(var t in e.fields)e.fields[t].view_mode();return e},FVForm.prototype.on_submit=function(e){var t=this;return t.submit_callbacks.push(e),t},FVForm.prototype.submit=function(){for(var e=this,t=e.val(),r=0;r<e.submit_callbacks.length;r++){var i=e.submit_callbacks[r];i(t)}return t},FVForm.prototype.add_field=function(e,t){var r=this;return t.container.appendTo(r.fields_element),r.fields[e]=t,r},FVForm.prototype.remove_field=function(e){var t=this,r=t.fields[e];r&&(r.remove(),delete t.fields[e])},FVForm.prototype.clear_errors=function(){var e=this;e.error(null)},FVForm.prototype.fields_error=function(e){var t=this;if(e){var r=e.invalid||{},i=e.missing||{},o=e.unrecognized||{};for(var n in t.fields){var l=t.fields[n],a=r[n]||i[n]||o[n]||null;l.error(a)}}else for(var n in t.fields){var l=t.fields[n];l.error(null)}},FVForm.prototype.show_error=function(){var e=this;e.error_message.show()},FVForm.prototype.hide_error=function(){var e=this;e.error_message.hide()},FVForm.prototype.error=function(e){var t=this;if(t.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)t.fields_error(e),t.hide_error();else{if(4===e.error){for(var r=$("<ul />"),i=0;i<e.errors.length;i++){var o=e.errors[i];0===o.error?t.fields_error(o):r.append($("<li />").text(o.error_message))}t.error_message.append(r)}else t.error_message.append($("<span />").text(e.error_message));t.show_error()}}else t.fields_error(null),t.hide_error()},FVForm.prototype.disable=function(){var e=this;for(var t in e.fields){var r=e.fields[t];r.disable()}},FVForm.prototype.enable=function(){var e=this;for(var t in e.fields){var r=e.fields[t];r.enable()}},FVForm.prototype.val=function(e){var t=this;if(0===arguments.length){var r={};for(var i in t.fields){var o=t.fields[i];if(o.show_on_form_flag!==!1){var n=o.val();null!=n&&(r[i]=n)}}return r}for(var i in t.fields){var o=t.fields[i];o.val(e[i])}return t},Field.prototype.init=function(){},Field.prototype.remove=function(){var e=this;e.container.remove()},Field.prototype.view_mode=function(){},Field.prototype.edit_mode=function(){},Field.prototype.change_name=function(e){var t=this;return t.name=e,t},Field.prototype.layout=function(){var e=this;e.container.append(e.title,e.element.append(e.input_holder,e.error_message))},Field.prototype.on_change=function(e){var t=this;return t.on_change_callbacks.push(e),t},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,t=e.val(),r=0;r<e.on_change_callbacks.length;r++){var i=e.on_change_callbacks[r];i(t)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var t=this;if(e){if(t.error_message.empty(),4===e.error){for(var r=$("<ul />"),i=0;i<e.errors.length;i++){var o=e.errors[i];r.append($("<li />").text(o.error_message))}t.error_message.append(r)}else t.error_message.append($("<span />").text(e.error_message));t.container&&t.container.addClass("field_error"),t.show_error()}else t.hide_error(),t.container&&t.container.removeClass("field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.view_mode=function(){var e=this;e.input.prop({readonly:"readonly",disabled:"disabled"}),e.element.addClass("view_mode")},TextField.prototype.edit_mode=function(){var e=this;e.input.prop({readonly:null,disabled:null}),e.element.removeClass("view_mode")},TextField.prototype.icon=function(e){var t=this,r={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return t.input.css(r),t},TextField.prototype.change_name=function(e){var t=this;return TextField.superClass.change_name.call(this,e),t.input.attr("placeholder",e),t},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^\d+(\.\d+)?$/,TextField.prototype.val=function(e){var t=this;if(0===arguments.length){var r=t.input.val();return"number"===t.input_type&&TextField.numeric_regex.test(r)?parseFloat(r):0===r.length?null:r}return t.input.val(e),t},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var t=this,r={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return t.input.css(r),t},DisplayField.prototype.change_name=function(e){var t=this;return DisplayField.superClass.change_name.call(this,e),t},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var t=[],r=e.split(/\n/),i=jQuery(document.createElement("div")),o=0;o<r.length;o++)t.push(i.text(r[o]).html());return t.join("<br>")},DisplayField.prototype.val=function(e){var t=this;return 0===arguments.length?t.input.text():(t.input.html(DisplayField.replace_line_breaks(e)),t)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var t=this;if(0===arguments.length){var r=t.select.find(":selected"),i=r.index()-(t.allow_empty?1:0);return t.allow_empty&&0===i?null:t.choice_values[i]}return t.select.val(null!=e?e:t.choice_values[0]),t},fieldval_ui_extend(DateField,Field),DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var t=this;return DateField.superClass.change_name.call(this,e),t.input.attr("placeholder",e),t},DateField.prototype.disable=function(){var e=this;return e.day_input.attr("disabled","disabled"),e.month_input.attr("disabled","disabled"),e.year_input.attr("disabled","disabled"),e},DateField.prototype.enable=function(){var e=this;return e.day_input.attr("disabled",null),e.month_input.attr("disabled",null),e.year_input.attr("disabled",null),e},DateField.prototype.focus=function(){var e=this;return e.day_input.focus(),e},DateField.prototype.blur=function(){var e=this;return e.day_input.blur(),e.month_input.blur(),e.year_input.blur(),e},DateField.prototype.val=function(e){var t=this;if(0===arguments.length){var r=t.day_input.val(),i=t.month_input.val(),o=t.year_input.val(),n=o+"-"+i+"-"+r;return n}if(null!=e){var r=e.substring(8,10),i=e.substring(5,7),o=e.substring(0,4);t.day_input.val(r),t.month_input.val(i),t.year_input.val(o)}return t},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var t=this;return 0===arguments.length?t.input.is(":checked"):(t.input.prop("checked",e),t)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.init=function(){FVForm.prototype.init.call(this)},ObjectField.prototype.remove=function(){FVForm.prototype.remove.call(this),Field.prototype.remove.call(this)},ObjectField.prototype.add_field=function(e,t){FVForm.prototype.add_field.call(this,e,t)},ObjectField.prototype.change_name=function(e){var t=this;return ObjectField.superClass.change_name.call(this,e),t},ObjectField.prototype.view_mode=function(){var e=this;for(var t in e.fields)e.fields[t].view_mode()},ObjectField.prototype.edit_mode=function(){var e=this;for(var t in e.fields)e.fields[t].edit_mode()},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){FVForm.prototype.blur.call(this)},ObjectField.prototype.error=function(e){ObjectField.superClass.error.call(this,e),FVForm.prototype.error.call(this,e)},ObjectField.prototype.fields_error=function(e){FVForm.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){FVForm.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var t=this;if(0===arguments.length){var r={};for(var i in t.fields){var o=t.fields[i];r[i]=o.val()}return r}for(var i in e){var o=t.fields[i];o&&o.val(e[i])}return t};